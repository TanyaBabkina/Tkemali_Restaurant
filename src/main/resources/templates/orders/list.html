<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>–ó–∞–∫–∞–∑—ã</title>
    <link rel="stylesheet" href="/css/style.css">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
<script src="/js/token-check.js"></script>
<!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –æ–±—â–µ–≥–æ header -->
<header th:replace="~{includes/header :: header}"></header>

<section class="orders container mt-4">
    <h2 class="mb-4">–ó–∞–∫–∞–∑—ã</h2>
    <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ -->
    <div class="mb-3">
        <a class="btn btn-success" href="/home/orders/add">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</a>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ –∑–∞–∫–∞–∑–æ–≤ -->
    <div class="table-responsive">
        <table class="table table-bordered table-hover">
            <thead class="thead-dark">
            <tr>
                <th>ID</th>
                <th>–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞</th>
                <th>
                    –î–∞—Ç–∞
                    <button type="button" id="sortDateBtn" class="btn btn-sm btn-light ml-2">‚Üë‚Üì</button>
                </th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–ò—Ç–æ–≥ (‚ÇΩ)</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
            </thead>
            <tbody id="eventsTableBody">
            <tr th:each="order : ${orders}">
                <td th:text="${order.id}"></td>
                <td th:text="${order.customerName}"></td>
                <td th:text="${#temporals.format(order.orderDate, 'yyyy-MM-dd HH:mm')}" th:attr="data-date=${order.orderDate}"></td>
                <td>
                    <span th:if="${order.status.toString() == '–í_–û–ñ–ò–î–ê–ù–ò–ò'}" th:text="'–í –æ–∂–∏–¥–∞–Ω–∏–∏'"></span>
                    <span th:if="${order.status.toString() == '–ó–ê–í–ï–†–®–ï–ù'}" th:text="'–ó–∞–≤–µ—Ä—à–µ–Ω'"></span>
                    <span th:if="${order.status.toString() == '–í–´–ü–û–õ–ù–Ø–ï–¢–°–Ø'}" th:text="'–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è'"></span>
                    <span th:if="${order.status.toString() == '–û–¢–ú–ï–ù–ï–ù'}" th:text="'–û—Ç–º–µ–Ω–µ–Ω'"></span>
                </td>
                <td th:text="${order.totalPrice}"></td>
                <td>
                    <button class="btn btn-info btn-sm" th:data-order-id="${order.id}" onclick="loadOrderDetails(this)" data-toggle="modal" data-target="#orderDetailsModal">Ô∏ô</button>
                    <a th:href="@{/home/orders/edit/{id}(id=${order.id})}" class="btn btn-warning btn-sm">‚úèÔ∏è</a>
                    <a th:href="@{/home/orders/delete/{id}(id=${order.id})}" class="btn btn-danger btn-sm" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–∫–∞–∑?');">üóëÔ∏è</a>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    <nav aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º" class="mt-4">
        <ul class="pagination justify-content-center">
            <!-- Previous Page Link -->
            <li th:classappend="${currentPage == 0} ? 'disabled'" class="page-item">
                <a th:href="@{/home/orders(page=${currentPage - 1}, size=${size})}" class="page-link">–ù–∞–∑–∞–¥</a>
            </li>

            <!-- Page Number Links -->
            <li th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                th:classappend="${i == currentPage} ? 'active'" class="page-item">
                <a th:href="@{/home/orders(page=${i}, size=${size})}" class="page-link" th:text="${i + 1}"></a>
            </li>

            <!-- Next Page Link -->
            <li th:classappend="${currentPage == totalPages - 1} ? 'disabled'" class="page-item">
                <a th:href="@{/home/orders(page=${currentPage + 1}, size=${size})}" class="page-link">–í–ø–µ—Ä–µ–¥</a>
            </li>
        </ul>
    </nav>


    <!-- –ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ –∑–∞–∫–∞–∑–æ–≤ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º -->
    <h4 class="mt-5">–ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ –∑–∞–∫–∞–∑–æ–≤ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º</h4>
    <canvas id="orderStatusChart" width="400" height="200"></canvas>
</section>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π –∑–∞–∫–∞–∑–∞ -->
<div class="modal fade" id="orderDetailsModal" tabindex="-1" aria-labelledby="orderDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="orderDetailsModalLabel">–î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div id="orderDetailsContent">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>
</div>

<!-- –°–∫—Ä–∏–ø—Ç—ã -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script th:inline="javascript">
    /*<![CDATA[*/
    const orderStatusData = /*[[${orderStatusData}]]*/ [];
    const labels = Object.keys(orderStatusData);
    const data = Object.values(orderStatusData);
    /*]]>*/

    const ctx = document.getElementById('orderStatusChart').getContext('2d');



    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤',
                data: data,
                backgroundColor: 'rgba(54, 162, 235, 0.5)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤'
                    }
                }
            }
        }
    });
</script>


<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="/js/order-details.js"></script>
<script src="/js/sort.js"></script>
<script src="/js/url-init.js"></script>
<script src="/js/logout.js"></script>

</body>
</html>
